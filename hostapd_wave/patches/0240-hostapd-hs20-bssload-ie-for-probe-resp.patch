From 37bcaefae1f7fd4b1fe641b03ca34d2044947155 Mon Sep 17 00:00:00 2001
From: grishche <a.grishchenko@intel.com>
Date: Tue, 6 Feb 2018 12:55:03 +0200
Subject: [PATCH] hostapd-hs20-bssload-ie-for-probe-resp

---
 src/ap/beacon.c | 20 ++++++++++----------
 1 file changed, 10 insertions(+), 10 deletions(-)

diff --git a/src/ap/beacon.c b/src/ap/beacon.c
index 3163b6d..7284cb1 100644
--- a/src/ap/beacon.c
+++ b/src/ap/beacon.c
@@ -48,15 +48,14 @@ static u8 * hostapd_eid_bss_load(struct hostapd_data *hapd, u8 *eid, size_t len)
 		return eid;
 	}
 #endif /* CONFIG_TESTING_OPTIONS */
-	if (hapd->conf->bss_load_update_period) {
-		*eid++ = WLAN_EID_BSS_LOAD;
-		*eid++ = 5;
-		WPA_PUT_LE16(eid, hapd->num_sta);
-		eid += 2;
-		*eid++ = hapd->iface->channel_utilization;
-		WPA_PUT_LE16(eid, 0); /* no available admission capabity */
-		eid += 2;
-	}
+
+    if (!hapd->conf->hs20)
+        return eid;
+
+    /* generated BSS Load IE, will be updated by driver */
+	*eid++ = WLAN_EID_BSS_LOAD;
+	*eid++ = 5;
+	eid += 5;
 	return eid;
 }
 
@@ -1096,9 +1095,10 @@ int ieee802_11_build_ap_params(struct hostapd_data *hapd,
 	tailpos = hostapd_eid_rm_enabled_capab(hapd, tailpos,
 					       tail + BEACON_TAIL_BUF_SIZE -
 					       tailpos);
-
+#if 0 /* BSS Load IE for Beacon will be generated by FW */
 	tailpos = hostapd_eid_bss_load(hapd, tailpos,
 				       tail + BEACON_TAIL_BUF_SIZE - tailpos);
+#endif
 
 	/* todo: hostapd_eid_ecsa has been patched to exclude this element. Remove
 	 * patch once NL80211_ATTR_MAX_CSA_COUNTERS becomes available in kernel. */
-- 
2.10.1

